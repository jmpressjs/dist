/*!
 * plugin for jmpress.js v0.4.5
 *
 * Copyright 2014 Kyle Robinson Young @shama & Tobias Koppers @sokra
 * Licensed MIT
 * http://www.opensource.org/licenses/mit-license.php
 */!function(a,b,c){"use strict";var d=a.jmpress,e="jmpress-presentation-";d("defaults").presentationMode={use:!0,url:"presentation-screen.html",notesUrl:!1,transferredValues:["userZoom","userTranslateX","userTranslateY"]},d("defaults").keyboard.keys[80]="presentationPopup",d("afterInit",function(b,d){var f=d.current;if(f.selectMessageListeners=[],d.settings.presentationMode.use){c.addEventListener("message",function(b){try{if("string"!=typeof b.data||0!==b.data.indexOf(e))return;var g=JSON.parse(b.data.slice(e.length));switch(g.type){case"select":a.each(d.settings.presentationMode.transferredValues,function(a,b){d.current[b]=g[b]}),/[a-z0-9\-]+/i.test(g.targetId)&&typeof g.substep in{number:1,undefined:1}?a(d.jmpress).jmpress("select",{step:"#"+g.targetId,substep:g.substep},g.reason):a.error("For security reasons the targetId must match /[a-z0-9\\-]+/i and substep must be a number.");break;case"listen":f.selectMessageListeners.push(b.source);break;case"ok":clearTimeout(f.presentationPopupTimeout);break;case"read":try{b.source.postMessage(e+JSON.stringify({type:"url",url:c.location.href,notesUrl:d.settings.presentationMode.notesUrl}),"*")}catch(h){a.error("Cannot post message to source: "+h)}break;default:throw"Unknown message type: "+g.type}}catch(h){a.error("Received message is malformed: "+h)}});try{c.parent&&c.parent!==c&&c.parent.postMessage(e+JSON.stringify({type:"afterInit"}),"*")}catch(g){a.error("Cannot post message to parent: "+g)}}}),d("afterDeinit",function(b,d){if(d.settings.presentationMode.use)try{c.parent&&c.parent!==c&&c.parent.postMessage(e+JSON.stringify({type:"afterDeinit"}),"*")}catch(f){a.error("Cannot post message to parent: "+f)}}),d("setActive",function(b,c){var d=a(c.delegatedFrom).attr("id"),f=c.substep,g=c.reason;a.each(c.current.selectMessageListeners,function(b,h){try{var i={type:"select",targetId:d,substep:f,reason:g};a.each(c.settings.presentationMode.transferredValues,function(a,b){i[b]=c.current[b]}),h.postMessage(e+JSON.stringify(i),"*")}catch(j){a.error("Cannot post message to listener: "+j)}})}),d("register","presentationPopup",function(){function b(){f.jmpress("current").presentationPopupTimeout=setTimeout(b,100);try{d.postMessage(e+JSON.stringify({type:"url",url:c.location.href,notesUrl:f.jmpress("settings").presentationMode.notesUrl}),"*")}catch(a){}}var d,f=a(this);f.jmpress("settings").presentationMode.use&&(d=c.open(a(this).jmpress("settings").presentationMode.url),f.jmpress("current").presentationPopupTimeout=setTimeout(b,100))})}(jQuery,document,window);